# 需求说明

实现从HTTP服务器多线程下载一个文件到本地。

## 要求

1. 在Linux环境下用C++开发；
2. 与HTTP服务器通信的方法不限，可以自己处理HTTP协议，也可以用现成的开源工具(如libcurl)与HTTP服务器进行通信；相关协议及文档可上网查询；
3. 多线程下载的处理方式需要自己通过程序实现，不要抄袭网上的代码；
4. 程序需要有良好的可扩展性，保证以后能方便地增加其它协议(如FTP)的支持而不需要改动多线程下载逻辑的实现；(可选择多态、模板、traits等技术)
5. 提供使用g++编译程序的Makefile,同时Makefile也需要考虑可扩展性；
6. 注意编码风格及注释；
7. 自己使用网上提供MD5或SHA校验的资源进行验证。
8. 支持断点续传

## 大概思路

### 多线程下载的设计思路

利用 curl 实现一个多线程下载功能

1. 判断下载地址和下载地址是否有效
2. 获取下载文件的文件大小
3. 根据待下载的文件大小在本地预生成一个同样大小的文件
4. 根据线程数量决定分片大小(利用range),开始多线程下载

这里可以考虑使用一个线程池并且支持设置一个线程下载的文件大小比如 50M, 这样可以保证小文件不用开启过多线程, 大文件可以跑满线程池

可以理解是对文件分片，每个片段利用range建立一个线程下载

### 断点续传

依然利用 range, 中途停止，保存已经未下载的 range, 重新创建线程 range

### 本地文件读写

1. fopen, fwrite 多线程需要加锁并且通过 fseek 跳转写入位置保证不乱序
2. open + mmap 内存映射，直接通过 memcpy 写入文件, 不用考虑锁的问题

### 线程池

直接使用三方线程轮子
线程池数量这里， 因为是 I/O密集型 可以简单点直接用 2N(N是CPU核心数量)

### MD5

```linux
md5sum QQ9.7.19.29259.exe
```

## 测试

测试地址：<https://dldir1.qq.com/qqfile/qq/PCQQ9.7.19/QQ9.7.19.29259.exe>

测试命令：./MultiDownload -H https://dldir1.qq.com/qqfile/qq/PCQQ9.7.19/QQ9.7.19.29259.exe
